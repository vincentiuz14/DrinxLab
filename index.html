<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DrinxLab â€“ Custom Drinks</title>
<style>
  body{margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#0a0a0a,#1a0029);color:#fff;text-align:center;padding:20px;}
  .logo{font-size:3em;font-weight:bold;color:#39ff14;text-shadow:0 0 5px #39ff14,0 0 10px #00eaff,0 0 20px #39ff14;margin-bottom:20px;animation:flicker 2s infinite alternate;}
  @keyframes flicker{from{opacity:1;}to{opacity:0.85;}}
  body,label,select,button,textarea,h2,p,li,option,span{ text-shadow:0 0 5px #39ff14,0 0 10px #00eaff,0 0 15px #ff00ff; }
  .form-section,.result{background:rgba(20,20,40,0.9);border:2px solid #39ff14;border-radius:12px;padding:15px;margin:20px auto;max-width:400px;box-shadow:0 0 15px #00eaff;word-wrap:break-word;}
  select,input[type="range"],textarea{width:90%;padding:10px;margin:5px auto;border-radius:8px;border:2px solid #39ff14;background:#111;color:#fff;font-size:1em;display:block;}
  button{margin-top:20px;padding:12px 30px;background:#00eaff;border:none;border-radius:10px;color:#000;font-weight:bold;font-size:1.1em;cursor:pointer;box-shadow:0 0 15px #00eaff,0 0 30px #39ff14;transition:.3s;text-shadow:0 0 5px #39ff14,0 0 10px #ff00ff;}
  button:hover{background:#39ff14;box-shadow:0 0 20px #39ff14,0 0 40px #00eaff;}
  .loading{display:none;margin:20px auto;border:6px solid #333;border-top:6px solid #39ff14;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;}
  @keyframes spin{100%{transform:rotate(360deg);}}
  .result{display:none;text-align:left;}
  .muted{opacity:.9;font-size:.95em}
</style>
</head>
<body>

<div class="logo">âœ¨ DrinxLab âœ¨</div>

<div class="form-section">
  <label for="language">ğŸŒ Pilih Bahasa / Choose Language:</label>
  <select id="language">
    <option value="id">Indonesia</option>
    <option value="en">English</option>
  </select>

  <label for="mood">ğŸ­ Mood Anda / Your Mood:</label>
  <select id="mood">
    <option value="Energetic">âš¡ Energetic</option>
    <option value="Relaxed">ğŸŒ™ Relaxed</option>
    <option value="Happy">ğŸ˜Š Happy</option>
    <option value="Romantic">â¤ï¸ Romantic</option>
    <option value="Surprise">ğŸ Surprise Me!</option>
  </select>

  <label for="flavors">ğŸ§ª Pilih Rasa / Choose Flavors:</label>
  <select id="flavors" multiple>
    <option value="Strawberry">ğŸ“ Strawberry</option>
    <option value="Mango">ğŸ¥­ Mango</option>
    <option value="Lychee">ğŸ’ Lychee</option>
    <option value="Lemon">ğŸ‹ Lemon</option>
    <option value="Orange">ğŸŠ Orange</option>
    <option value="Pineapple">ğŸ Pineapple</option>
    <option value="Coconut">ğŸ¥¥ Coconut</option>
    <option value="Blueberry">ğŸ« Blueberry</option>
    <option value="Matcha">ğŸ«– Matcha</option>
    <option value="Chocolate">ğŸ« Chocolate</option>
    <option value="Vanilla">ğŸ¦ Vanilla</option>
    <option value="Caramel">ğŸ¯ Caramel</option>
    <option value="Coffee">â˜• Coffee</option>
  </select>

  <label for="toppings">ğŸ¬ Pilih Topping / Choose Toppings:</label>
  <select id="toppings" multiple>
    <option value="Boba">Boba</option>
    <option value="Jelly">Jelly</option>
    <option value="Whipped Cream">Whipped Cream</option>
    <option value="Chocolate Chips">Chocolate Chips</option>
    <option value="Oreo Crumble">Oreo Crumble</option>
  </select>

  <label for="strength">âš¡ Kekuatan Rasa / Flavor Strength: <span id="strengthValue">50%</span></label>
  <input type="range" id="strength" min="10" max="100" value="50" />

  <label for="size">ğŸ¥¤ Ukuran Minuman / Drink Size:</label>
  <select id="size">
    <option value="250">250 ml</option>
    <option value="350">350 ml</option>
    <option value="500">500 ml</option>
  </select>

  <label for="ice">ğŸ§Š Tingkat Es / Ice Level:</label>
  <select id="ice">
    <option value="0">Tanpa Es / No Ice</option>
    <option value="25">Sedikit Es / Light Ice</option>
    <option value="50">Normal Ice</option>
    <option value="75">Banyak Es / Extra Ice</option>
  </select>

  <label for="base">ğŸ’§ Dasar Minuman / Base Liquid:</label>
  <select id="base">
    <option value="milk">Susu</option>
    <option value="water">Air</option>
    <option value="soda">Soda</option>
  </select>

  <label for="notes">âœï¸ Pesan Tambahan / Extra Notes:</label>
  <textarea id="notes" rows="2" placeholder="Contoh: kurang manis, tambah topping..."></textarea>

  <button onclick="generateRecipe()">ğŸ”¬ Generate Resep</button>
  <div class="loading" id="loading"></div>
</div>

<div class="result" id="result"></div>

<script>
  const langText = {
    id: { result: "ğŸ“‹ Resep Minuman Anda:", total:"Total", base:"Base", steps:"Step by Step" },
    en: { result: "ğŸ“‹ Your Drink Recipe:", total:"Total", base:"Base", steps:"Step by Step" }
  };

  const baseLabel = { milk:"Susu", water:"Air", soda:"Soda" };

  document.getElementById("strength").addEventListener("input", function(){
    document.getElementById("strengthValue").textContent = this.value + "%";
  });

  // helper pembulatan 1 desimal
  const round1 = x => Math.round(x*10)/10;

  function generateRecipe(){
    try {
      const lang = document.getElementById("language").value;
      let mood = document.getElementById("mood").value;
      const flavors = Array.from(document.getElementById("flavors").selectedOptions).map(o=>o.value);
      const toppings = Array.from(document.getElementById("toppings").selectedOptions).map(o=>o.value);
      const strength = parseInt(document.getElementById("strength").value);
      const size = parseInt(document.getElementById("size").value);
      const iceLevel = parseInt(document.getElementById("ice").value);
      const base = document.getElementById("base").value;
      const notes = document.getElementById("notes").value.trim();

      if (flavors.length === 0) { alert(lang==='id'?'Pilih minimal 1 rasa!':'Pick at least 1 flavor!'); return; }

      if (mood === "Surprise") {
        const moods = ["Energetic","Relaxed","Happy","Romantic"];
        mood = moods[Math.floor(Math.random()*moods.length)];
      }

      // tampilkan loading
      const loader = document.getElementById("loading");
      const res = document.getElementById("result");
      loader.style.display = "block";
      res.style.display = "none";

      setTimeout(()=>{
        // hitung es (5 ml per kubus)
        const iceCubes = iceLevel===0?0 : iceLevel===25?3 : iceLevel===50?5 : 8;
        const iceVolume = iceCubes * 5;

        // batas syrup 25% dari size, dikalikan strength (10-100%)
        const totalSyrupRaw = size * 0.25 * (strength/100);
        // jadikan pembulatan 1 desimal agar rapi
        let totalSyrup = round1(totalSyrupRaw);

        // bagi rata ke tiap flavor, lalu koreksi rounding di flavor terakhir agar jumlah tepat
        const per = totalSyrup / flavors.length;
        let perList = Array(flavors.length).fill( round1(per) );
        // koreksi selisih
        const sumRounded = round1(perList.reduce((a,b)=>a+b,0));
        const diff = round1(totalSyrup - sumRounded);
        perList[perList.length-1] = round1(perList[perList.length-1] + diff);

        // base = sisa volume setelah es + total syrup
        let baseAmount = round1(size - iceVolume - perList.reduce((a,b)=>a+b,0));
        if (baseAmount < 0) { // kalau berlebih karena es & syrup, kurangi syrup sedikit
          // turunkan syrup supaya tidak negatif
          const need = Math.abs(baseAmount);
          const reduceEach = round1(need / flavors.length);
          perList = perList.map((v,i)=> i<flavors.length-1 ? round1(Math.max(0, v - reduceEach)) : round1(Math.max(0, v - (need - reduceEach*(flavors.length-1)))) );
          totalSyrup = round1(perList.reduce((a,b)=>a+b,0));
          baseAmount = round1(size - iceVolume - totalSyrup);
        }

        // rakit HTML hasil
        let html = "";
        html += `<h2>${langText[lang].result}</h2>`;
        html += `<p><b>Mood:</b> ${mood}</p>`;
        html += `<p><b>Ukuran:</b> ${size} ml</p>`;
        html += `<p><b>Rasa:</b> ${flavors.join(", ")}</p>`;
        html += `<p><b>${langText[lang].base}:</b> ${baseLabel[base]} (${base})</p>`;
        html += `<p><b>${langText[lang].steps]}:</b></p><ol>`;
        html += `<li>Masukkan es: <b>${iceCubes}</b> kubus (${round1(iceVolume)} ml)</li>`;
        flavors.forEach((f,idx)=>{
          html += `<li>Tambahkan sirup <b>${f}</b>: <b>${perList[idx].toFixed(1)}</b> ml</li>`;
        });
        html += `<li>Tambahkan <b>${baseLabel[base]}</b>: <b>${baseAmount.toFixed(1)}</b> ml</li>`;
        if (toppings.length>0) html += `<li>Tambahkan topping: ${toppings.join(", ")}</li>`;
        if (notes) html += `<li>Catatan: ${notes}</li>`;
        html += `</ol>`;

        const totalNow = round1(iceVolume + perList.reduce((a,b)=>a+b,0) + baseAmount);
        html += `<p class="muted"><b>Total:</b> ${totalNow.toFixed(1)} ml (target ${size} ml)</p>`;

        loader.style.display = "none";
        res.innerHTML = html;
        res.style.display = "block";
      }, 400);
    } catch (e) {
      alert("Error: " + e.message);
      console.error(e);
    }
  }
</script>

</body>
</html>
